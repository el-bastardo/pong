<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Pong</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <p id="scorePlayerOne"></p>
    <canvas id="myCanvas"></canvas>
    <p id="scorePlayerTwo"></p>
    <script>
        // define canvas
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        canvas.width = 500;
        canvas.height = 500;

        const speed = 5;

        class player {
            constructor(x, y, width, heigth, score, style, scoreAnzeige) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = heigth;
                this.score = score;
                this.style = style;
                this.scoreAnzeige = scoreAnzeige;
            }

            renderPlayer() {
                ctx.fillStyle = this.style;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                ctx.strokeRect(this.x, this.y, this.width, this.height);
            }

            updateScore(scoreData, id) {
                var anzeige = document.getElementById(this.scoreAnzeige);
                anzeige.innerHTML = "Score: " + this.score;
            }
        }

        let playerOne = new player(215, 20, 70, 20, 0, "#003366", "scorePlayerOne");
        let playerTwo = new player(215, 460, 70, 20, 0, "#990033", "scorePlayerTwo");

        class controller {
            constructor(moveLeft, moveRight, keyCodeLeft, keyCodeRight) {
                this.moveLeft = moveLeft;
                this.moveRight = moveRight;
                this.keyCodeLeft = keyCodeLeft;
                this.keyCodeRight = keyCodeRight;
            }
        }

        let controllerOne = new controller(false, false, 39, 40, 60);
        let controllerTwo = new controller(false, false, 68, 65, 60);

        var ball = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            ballRadius: 10,
            dx: 1.5,
            dy: 1.5,
        }

        function renderCanvas() {
            ctx.fillStyle = "#000000";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        playerOne.renderPlayer();
        playerTwo.renderPlayer();
        
        document.addEventListener("keydown", keyDownHandler, false);
        document.addEventListener("keyup", keyUpHandler, false);

        function keyDownHandler(e) {
            if (e.keyCode == 39) {
                controllerOne.moveRight = true;
            } else if (e.keyCode == 37) {
                controllerOne.moveLeft = true;
            } else if (e.keyCode == 68) {
                controllerTwo.moveRight = true;
            } else if (e.keyCode == 65) {
                controllerTwo.moveLeft = true;
            }
        }

        function keyUpHandler(e) {
            if (e.keyCode == 39) {
                controllerOne.moveRight = false;
            } else if (e.keyCode == 37) {
                controllerOne.moveLeft = false;
            } else if (e.keyCode == 68) {
                controllerTwo.moveRight = false;
            } else if (e.keyCode == 65) {
                controllerTwo.moveLeft = false;
            }
        }

        //move playerOne using left and right arrow key and playerTwo using A and D
        function movePlayer() {

                if (controllerOne.moveRight && playerOne.x < canvas.width - playerOne.width) {
                    playerOne.x += speed; //right arrow add 20 from current
                } else if (controllerOne.moveLeft && playerOne.x > 10) {
                    playerOne.x -= speed; //left arrow subtract 20 from current
                } else if (controllerTwo.moveRight && playerTwo.x <= canvas.width - playerTwo.width) {
                    playerTwo.x += speed; //D add 20 from current)
                } else if (controllerTwo.moveLeft && playerTwo.x > 10) {
                    playerTwo.x -= speed; //A subtract 20 from current
                }
            }

        function renderBall() {
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.ballRadius, 0, 2 * Math.PI);
            ctx.fillStyle = "#FFFFFF";
            ctx.fill();

            if (ball.x + ball.dx > canvas.width - ball.ballRadius) {
                ball.dx = -ball.dx;
            }
            if (ball.x + ball.dx < ball.ballRadius) {
                ball.dx = -ball.dx;
            }
            if (ball.x - ball.ballRadius >= playerOne.x && ball.x - ball.ballRadius <= playerOne.x + playerOne.width && ball.y - ball.ballRadius >= playerOne.y && ball.y - ball.ballRadius <= playerOne.y + playerOne.height) {
                //  ball.dx = -ball.dx;
                ball.dy = -ball.dy;
                ball.dy += 0.5;
            }
            if (ball.x + ball.ballRadius >= playerTwo.x && ball.x + ball.ballRadius <= playerTwo.x + playerTwo.width && ball.y + ball.ballRadius >= playerTwo.y && ball.y + ball.ballRadius <= playerTwo.y + playerTwo.height) {
                //  ball.dx = -ball.dx;
                ball.dy = -ball.dy;
                ball.dy -= 0.5;
            }
            if (ball.y + ball.dy > canvas.height - ball.ballRadius) {
                restart();
                playerOne.score++;
                ball.dy = 1.5;
            }
            if (ball.y + ball.dy < ball.ballRadius) {
                restart();
                playerTwo.score++;
                ball.dy = 1.5;
            }

            ball.x += ball.dx;
            ball.y += ball.dy;
        }

        function game() {
            renderCanvas();
            playerOne.renderPlayer();
            playerTwo.renderPlayer();
            playerOne.updateScore();
            playerTwo.updateScore();
            renderBall();
            movePlayer();
        }

        var interval = setInterval(game, 10);

        function restart() {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
        }

    </script>
</body>

</html>
